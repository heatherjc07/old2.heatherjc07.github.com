<figure class='code-highlight-figure'><figcaption class='code-highlight-caption'><span class='code-highlight-caption-title'>protocol.clj</span><a class='code-highlight-caption-link' href='https://gist.github.com/8174263'>link</a></figcaption><div class='code-highlight'><pre class='code-highlight-pre'><div data-line='1' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="c1">;define namespace</span>
</div></div><div data-line='2' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="p">(</span><span class="kd">ns </span><span class="nv">com.campbell</span><span class="p">)</span>
</div></div><div data-line='3' class='code-highlight-row numbered'><div class='code-highlight-line'> </div></div><div data-line='4' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="c1">;define a protocol</span>
</div></div><div data-line='5' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="p">(</span><span class="kd">defprotocol </span><span class="nv">Fulfillment</span>
</div></div><div data-line='6' class='code-highlight-row numbered'><div class='code-highlight-line'> <span class="p">(</span><span class="nf">invoice</span> <span class="p">[</span><span class="nv">this</span><span class="p">]</span> <span class="s">&quot;Returns an invoice&quot;</span><span class="p">)</span>
</div></div><div data-line='7' class='code-highlight-row numbered'><div class='code-highlight-line'> <span class="p">(</span><span class="nf">manifest</span> <span class="p">[</span><span class="nv">this</span><span class="p">]</span> <span class="s">&quot;Returns a shipping manifest&quot;</span><span class="p">))</span>
</div></div><div data-line='8' class='code-highlight-row numbered'><div class='code-highlight-line'> </div></div><div data-line='9' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="c1">;define a product record</span>
</div></div><div data-line='10' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="p">(</span><span class="kd">defrecord </span><span class="nv">Product</span> <span class="p">[</span><span class="nb">name </span><span class="nv">price</span><span class="p">])</span>
</div></div><div data-line='11' class='code-highlight-row numbered'><div class='code-highlight-line'> </div></div><div data-line='12' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="c1">;create pencil product record and check fields</span>
</div></div><div data-line='13' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="p">(</span><span class="k">def </span><span class="nv">pencil</span> <span class="p">(</span><span class="nf">Product.</span> <span class="s">&quot;Pencil&quot;</span> <span class="mi">30</span><span class="p">))</span>
</div></div><div data-line='14' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="p">(</span><span class="nb">println </span><span class="p">(</span><span class="ss">:name</span> <span class="nv">pencil</span><span class="p">))</span>
</div></div><div data-line='15' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="p">(</span><span class="nb">println </span><span class="p">(</span><span class="ss">:price</span> <span class="nv">pencil</span><span class="p">))</span>
</div></div><div data-line='16' class='code-highlight-row numbered'><div class='code-highlight-line'> </div></div><div data-line='17' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="c1">;create pen product record and check fields</span>
</div></div><div data-line='18' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="p">(</span><span class="k">def </span><span class="nv">pen</span> <span class="p">(</span><span class="nf">Product.</span> <span class="s">&quot;Pen&quot;</span> <span class="mi">150</span><span class="p">))</span>
</div></div><div data-line='19' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="p">(</span><span class="nb">println </span><span class="p">(</span><span class="ss">:name</span> <span class="nv">pen</span><span class="p">))</span>
</div></div><div data-line='20' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="p">(</span><span class="nb">println </span><span class="p">(</span><span class="ss">:price</span> <span class="nv">pen</span><span class="p">))</span>
</div></div><div data-line='21' class='code-highlight-row numbered'><div class='code-highlight-line'> </div></div><div data-line='22' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="c1">;function for current time, not nicely formatted</span>
</div></div><div data-line='23' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="p">(</span><span class="kd">defn </span><span class="nv">current-time</span> <span class="p">[]</span> 
</div></div><div data-line='24' class='code-highlight-row numbered'><div class='code-highlight-line'>  <span class="p">(</span><span class="k">. </span><span class="p">(</span><span class="k">new </span><span class="nv">java.util.Date</span><span class="p">)</span> <span class="p">(</span><span class="nf">toString</span><span class="p">)))</span> 
</div></div><div data-line='25' class='code-highlight-row numbered'><div class='code-highlight-line'> </div></div><div data-line='26' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="c1">;list of products purchased</span>
</div></div><div data-line='27' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="p">(</span><span class="k">def </span><span class="nv">products</span> <span class="p">&#x7b;</span><span class="nv">pen</span> <span class="mi">1</span>, <span class="nv">pencil</span> <span class="mi">5</span><span class="p">&#x7d;)</span>
</div></div><div data-line='28' class='code-highlight-row numbered'><div class='code-highlight-line'> </div></div><div data-line='29' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="c1">;function to build pretty product list string</span>
</div></div><div data-line='30' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="p">(</span><span class="kd">defn </span><span class="nv">product-string</span> <span class="p">[</span><span class="nv">products</span><span class="p">]</span> 
</div></div><div data-line='31' class='code-highlight-row numbered'><div class='code-highlight-line'> <span class="p">(</span><span class="nb">apply </span><span class="nv">str</span><span class="p">(</span><span class="nb">doall </span><span class="p">(</span><span class="nb">for </span><span class="p">[[</span><span class="nv">k</span> <span class="nv">v</span><span class="p">]</span> <span class="nv">products</span><span class="p">]</span> 
</div></div><div data-line='32' class='code-highlight-row numbered'><div class='code-highlight-line'>  <span class="p">(</span><span class="nb">str </span><span class="nv">v</span> <span class="s">&quot; &quot;</span><span class="p">(</span><span class="ss">:name</span> <span class="nv">k</span><span class="p">)</span> <span class="s">&quot; @ &quot;</span> <span class="p">(</span><span class="ss">:price</span> <span class="nv">k</span><span class="p">)</span> <span class="s">&quot; pence\n&quot;</span><span class="p">)))</span>
</div></div><div data-line='33' class='code-highlight-row numbered'><div class='code-highlight-line'> <span class="p">)</span>
</div></div><div data-line='34' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="p">)</span>
</div></div><div data-line='35' class='code-highlight-row numbered'><div class='code-highlight-line'> </div></div><div data-line='36' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="c1">; define a purchase order record which implements </span>
</div></div><div data-line='37' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="c1">; Fulfillment protocol</span>
</div></div><div data-line='38' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="p">(</span><span class="kd">defrecord </span><span class="nv">PurchaseOrder</span> <span class="p">[</span><span class="nv">date</span> <span class="nv">customer</span> <span class="nv">products</span><span class="p">]</span>
</div></div><div data-line='39' class='code-highlight-row numbered'><div class='code-highlight-line'> <span class="nv">Fulfillment</span>
</div></div><div data-line='40' class='code-highlight-row numbered'><div class='code-highlight-line'> <span class="p">(</span><span class="nf">invoice</span> <span class="p">[</span><span class="nv">this</span><span class="p">]</span>
</div></div><div data-line='41' class='code-highlight-row numbered'><div class='code-highlight-line'> <span class="p">(</span><span class="nb">str </span><span class="p">(</span><span class="nf">format</span> <span class="s">&quot;Invoice for %s \nDate %s&quot;</span> <span class="nv">customer</span> <span class="nv">date</span><span class="p">)</span> <span class="s">&quot;\n&quot;</span> 
</div></div><div data-line='42' class='code-highlight-row numbered'><div class='code-highlight-line'>        <span class="p">(</span><span class="nf">product-string</span> <span class="nv">products</span><span class="p">)))</span>
</div></div><div data-line='43' class='code-highlight-row numbered'><div class='code-highlight-line'> <span class="p">(</span><span class="nf">manifest</span> <span class="p">[</span><span class="nv">this</span><span class="p">]</span>
</div></div><div data-line='44' class='code-highlight-row numbered'><div class='code-highlight-line'> <span class="p">(</span><span class="nb">str </span><span class="s">&quot;Shipping to &quot;</span> <span class="nv">customer</span> <span class="s">&quot;\n&quot;</span> <span class="p">(</span><span class="nf">product-string</span> <span class="nv">products</span><span class="p">))))</span>
</div></div><div data-line='45' class='code-highlight-row numbered'><div class='code-highlight-line'> </div></div><div data-line='46' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="c1">; create puchase order object</span>
</div></div><div data-line='47' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="p">(</span><span class="k">def </span><span class="nv">po</span> <span class="p">(</span><span class="nf">PurchaseOrder.</span> <span class="p">(</span><span class="nf">current-time</span><span class="p">)</span>
</div></div><div data-line='48' class='code-highlight-row numbered'><div class='code-highlight-line'> <span class="s">&quot;Heather Campbell&quot;</span>
</div></div><div data-line='49' class='code-highlight-row numbered'><div class='code-highlight-line'> <span class="nv">products</span><span class="p">))</span>
</div></div><div data-line='50' class='code-highlight-row numbered'><div class='code-highlight-line'> </div></div><div data-line='51' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="c1">;print out various fields belonging to obj</span>
</div></div><div data-line='52' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="p">(</span><span class="nf">println</span><span class="p">(</span><span class="ss">:date</span> <span class="nv">po</span><span class="p">))</span>
</div></div><div data-line='53' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="p">(</span><span class="nf">println</span><span class="p">(</span><span class="ss">:customer</span> <span class="nv">po</span><span class="p">))</span>
</div></div><div data-line='54' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="p">(</span><span class="nf">println</span><span class="p">(</span><span class="ss">:products</span> <span class="nv">po</span><span class="p">))</span>
</div></div><div data-line='55' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="p">(</span><span class="nb">println </span><span class="p">(</span><span class="nf">invoice</span> <span class="nv">po</span><span class="p">))</span>
</div></div><div data-line='56' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="p">(</span><span class="nb">println </span><span class="p">(</span><span class="nf">manifest</span> <span class="nv">po</span><span class="p">))</span></div></div></pre></div></figure>