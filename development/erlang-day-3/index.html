<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Erlang Day 3 &#8211; Technical Musing of a Mummy</title>
<meta name="description" content="Erlang Day 3: Seven Languages in Seven Weeks">
<meta name="keywords" content="seven languages in seven weeks, erlang, languages">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://heatherjcampbell.com/images/">
<meta name="twitter:title" content="Erlang Day 3">
<meta name="twitter:description" content="Erlang Day 3: Seven Languages in Seven Weeks">
<meta name="twitter:creator" content="@hcampbell07">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Erlang Day 3">
<meta property="og:description" content="Erlang Day 3: Seven Languages in Seven Weeks">
<meta property="og:url" content="http://heatherjcampbell.com/development/erlang-day-3/">
<meta property="og:site_name" content="Technical Musing of a Mummy">





<link rel="canonical" href="http://heatherjcampbell.com/development/erlang-day-3/">
<link href="http://heatherjcampbell.com/feed.xml" type="application/atom+xml" rel="alternate" title="Technical Musing of a Mummy Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://heatherjcampbell.com/assets/css/main.min.css">
<link rel="stylesheet" href="http://heatherjcampbell.com/assets/css/code.css">
<!-- Webfonts -->
<script src="//use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://heatherjcampbell.com/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://heatherjcampbell.com/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://heatherjcampbell.com/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://heatherjcampbell.com/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://heatherjcampbell.com/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://heatherjcampbell.com/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://heatherjcampbell.com/images/apple-touch-icon-144x144-precomposed.png">
</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav">
	    <ul>
	        
			<li>
				
					<a href="http://heatherjcampbell.com/about/">About</a>
				 
			</li>
	        
			<li>
				
					<a href="http://heatherjcampbell.com/articles/">Posts</a>
				 
			</li>
	        
			<li>
				
					<a href="http://heatherjcampbell.com/tags/">Tags</a>
				 
			</li>
	        
			<li>
				
					<a href="https://twitter.com/HCampbell07/">Tweets</a>
				 
			</li>
	        
			<li>
				
					<a href="http://heatherjcampbell.com/presentations/">Presentations</a>
				 
			</li>
	        
			<li>
				
					<a href="http://heatherjcampbell.com/reading/">Reading List</a>
				 
			</li>
	        
	        <li><a href="http://heatherjcampbell.com/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
	        <li class="dosearch"><i class="icon-search"></i> Search</li>
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<div class="search-wrapper">
	<div class="search-form">
		<input type="text" class="search-field" placeholder="Search...">
		<i class="icon-remove-sign icon-2x"></i>
		<ul class="search-results post-list"></ul><!-- /.search-results -->
	</div><!-- /.search-form -->
</div><!-- ./search-wrapper -->

<header class="masthead">
	<div class="wrap">
        <h1 class="site-title"><a href="http://heatherjcampbell.com">Technical Musing of a Mummy</a></h1>
		<h2 class="site-description" itemprop="description">A Blog About All Things IT Related</h2>
	</div>
</header><!-- /.masthead -->

<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <span class="entry-tags"><a href="http://heatherjcampbell.com/tags/#seven languages in seven weeks" title="Pages tagged seven languages in seven weeks">seven languages in seven weeks</a>&nbsp;&bull;&nbsp;<a href="http://heatherjcampbell.com/tags/#erlang" title="Pages tagged erlang">erlang</a>&nbsp;&bull;&nbsp;<a href="http://heatherjcampbell.com/tags/#languages" title="Pages tagged languages">languages</a></span>
        
          <h1 class="entry-title">Erlang Day 3</h1>
        
      </header>
      <footer class="entry-meta">
        <img src="http://heatherjcampbell.com/images/bio-photo.JPG" alt="Heather Campbell photo" class="author-photo">
        <span class="author vcard">By <span class="fn"><a href="http://heatherjcampbell.com/about/" title="About Heather Campbell">Heather Campbell</a></span></span>
        <span class="entry-date date published"><time datetime="2012-11-05T00:00:00+00:00"><i class="icon-calendar-empty"></i> November 05, 2012</time></span>
        
        
        <span><a href="http://heatherjcampbell.com/development/erlang-day-3/" rel="bookmark" title="Erlang Day 3"><i class="icon-link"></i> Permalink</a></span>
        
        <span class="social-share-facebook">
            <a href="https://www.facebook.com/sharer/sharer.php?u=http://heatherjcampbell.com/development/erlang-day-3/" title="Share on Facebook" itemprop="Facebook"><i class="icon-facebook-sign"></i> Like</a></span>
        <span class="social-share-twitter">
            <a href="https://twitter.com/intent/tweet?hashtags=development&text=Erlang Day 3&url=http://heatherjcampbell.com/development/erlang-day-3/&via=hcampbell07" title="Share on Twitter" itemprop="Twitter"><i class="icon-twitter-sign"></i> Tweet</a></span>
        <span class="social-share-googleplus">
            <a href="https://plus.google.com/share?url=http://heatherjcampbell.com/development/erlang-day-3/" title="Share on Google Plus" itemprop="GooglePlus"><i class="icon-google-plus-sign"></i> +1</a></span>
            <!-- /.social-share -->
      </footer>
      <div class="entry-content">
        <p><em>My experience with day three of exploring Erlang through <a href="http://pragprog.com/book/btlang/seven-languages-in-seven-weeks" target="_blank">Seven Languages in Seven Weeks</a>.</em></p>

<p>After a couple of days of having to reprogram how I approach problems coming from an OO background I’m looking forwards to tackling the areas that Erlang excels at, concurrency and reliability.</p>

<h2 id="concurrency">Concurrency</h2>

<p>Concurrency in Erlang is build upon three basic primitives</p>

<ul>
  <li><strong>! :</strong> to send a message</li>
  <li><strong>spawn :</strong> to spawn a process</li>
  <li><strong>receive:</strong> to receive a message</li>
</ul>

<p>Lets start with a basic example where we create a function which receives a message from another process and displays the appropriate information based on the format of the message which was passed.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">buy.erl</span><a class="code-highlight-caption-link" href="https://gist.github.com/5554054">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">-</span><span class="ni">module</span><span class="p">(</span><span class="n">buy</span><span class="p">).</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">-</span><span class="ni">export</span><span class="p">([</span><span class="n">purchase</span><span class="o">/</span><span class="mi">0</span><span class="p">]).</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nf">purchase</span><span class="p">()</span> <span class="o">-&gt;</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="k">receive</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">     <span class="n">finished</span> <span class="o">-&gt;</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;purchases finished</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">[]);</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">     <span class="p">&#x7b;</span><span class="n">purchase</span><span class="p">,</span> <span class="nv">Item</span><span class="p">,</span> <span class="nv">Quantity</span><span class="p">&#x7d;</span> <span class="o">-&gt;</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;purchase received: </span><span class="si">~p</span><span class="s"> </span><span class="si">~p</span><span class="s"> </span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span> 
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">              <span class="p">[</span><span class="nv">Quantity</span><span class="p">,</span> <span class="nv">Item</span><span class="p">]),</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="n">purchase</span><span class="p">()</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">end</span><span class="p">.</span></div></div></pre></div></figure>

<p>If it receives a message of a finished atom it displays that the purchases have been completed and terminates.</p>

<p>If it receives a purchase atom it display the item and quantity which have been purchased and waits for the next purchase message.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">use_buy.erl</span><a class="code-highlight-caption-link" href="https://gist.github.com/5554054">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nf">c</span><span class="p">(</span><span class="n">buy</span><span class="p">).</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">Pid</span> <span class="o">=</span> <span class="nb">spawn</span><span class="p">(</span><span class="k">fun</span> <span class="nn">buy</span><span class="p">:</span><span class="n">purchase</span><span class="o">/</span><span class="mi">0</span><span class="p">).</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">Pid</span> <span class="o">!</span> <span class="p">&#x7b;</span><span class="n">purchase</span><span class="p">,</span> <span class="s">&quot;pen&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">&#x7d;.</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c">% prints &quot;purchase received: 3 pen&quot;</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">Pid</span> <span class="o">!</span> <span class="p">&#x7b;</span><span class="n">purchase</span><span class="p">,</span> <span class="s">&quot;desk&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">&#x7d;.</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c">% prints &quot;purchase received: 1 desk&quot;</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">Pid</span> <span class="o">!</span> <span class="n">finished</span><span class="p">.</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c">% prints &quot;purchases finished&quot;</span></div></div></pre></div></figure>

<p>In the code above we compile our module and use spawn to start our purchase function in a lightweight process. spawn returns a process ID which we store in a variable. We can then use this variable to send messages to our process with ! syntax. This is an asynchronous example where a message is being sent and the system which sends the message is not waiting on a reply.</p>

<h2 id="synchronous-messaging">Synchronous Messaging</h2>

<p>Lets modify our functions to support synchronous messaging. The helper method purchase sends a message to the function purchase including a reference to itself so purchase can send a message back indicating it has printed the purchase.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">buy_sync.erl</span><a class="code-highlight-caption-link" href="https://gist.github.com/5554054">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">-</span><span class="ni">module</span><span class="p">(</span><span class="n">buy_sync</span><span class="p">).</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">-</span><span class="ni">export</span><span class="p">([</span><span class="n">purchase</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span> <span class="n">purchaser</span><span class="o">/</span><span class="mi">3</span><span class="p">]).</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nf">purchase</span><span class="p">()</span> <span class="o">-&gt;</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="k">receive</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">     <span class="n">finished</span> <span class="o">-&gt;</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;purchases finished</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">[]);</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">     <span class="p">&#x7b;</span><span class="nv">From</span><span class="p">,&#x7b;</span><span class="n">purchase</span><span class="p">,</span> <span class="nv">Item</span><span class="p">,</span> <span class="nv">Quantity</span><span class="p">&#x7d;&#x7d;</span> <span class="o">-&gt;</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;purchase received: </span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="s">              </span><span class="si">~p</span><span class="s"> </span><span class="si">~p</span><span class="s"> </span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nv">Quantity</span><span class="p">,</span> <span class="nv">Item</span><span class="p">]),</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">     <span class="nv">From</span><span class="o">!</span> <span class="n">printed</span><span class="p">,</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">            <span class="n">purchase</span><span class="p">()</span>
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">end</span><span class="p">.</span>
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nf">purchaser</span><span class="p">(</span><span class="nv">To</span><span class="p">,</span> <span class="nv">Item</span><span class="p">,</span> <span class="nv">Quantity</span><span class="p">)</span> <span class="o">-&gt;</span>
</div></div><div data-line="15" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="nv">To</span> <span class="o">!</span> <span class="p">&#x7b;</span><span class="n">self</span><span class="p">(),</span> <span class="p">&#x7b;</span><span class="n">purchase</span><span class="p">,</span> <span class="nv">Item</span><span class="p">,</span> <span class="nv">Quantity</span> <span class="p">&#x7d;&#x7d;,</span>
</div></div><div data-line="16" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="k">receive</span>
</div></div><div data-line="17" class="code-highlight-row numbered"><div class="code-highlight-line">     <span class="n">printed</span> <span class="o">-</span><span class="err">&amp;</span><span class="n">gt</span><span class="p">;</span>
</div></div><div data-line="18" class="code-highlight-row numbered"><div class="code-highlight-line">           <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;Purchase Printed</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">[])</span>
</div></div><div data-line="19" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="20" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">end</span><span class="p">.</span>
</div></div><div data-line="21" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="22" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nf">c</span><span class="p">(</span><span class="n">buy_sync</span><span class="p">).</span>
</div></div><div data-line="23" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">PurchasePrinter</span> <span class="o">=</span> <span class="nb">spawn</span><span class="p">(</span><span class="k">fun</span> <span class="nn">buy_sync</span><span class="p">:</span><span class="n">purchase</span><span class="o">/</span><span class="mi">0</span><span class="p">).</span>
</div></div><div data-line="24" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nn">buy_sync</span><span class="p">:</span><span class="nf">purchaser</span><span class="p">(</span><span class="nv">PurchasePrinter</span><span class="p">,</span> <span class="s">&quot;pen&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">).</span>
</div></div><div data-line="25" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c">% prints &quot;purchase received: 3 pen&quot;</span>
</div></div><div data-line="26" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c">% prints &quot;Purchase Printed&quot;</span>
</div></div><div data-line="27" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nn">buy_sync</span><span class="p">:</span><span class="nf">purchaser</span><span class="p">(</span><span class="nv">PurchasePrinter</span><span class="p">,</span> <span class="s">&quot;desk&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span>
</div></div><div data-line="28" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c">% prints &quot;purchase received: 1 desk&quot;</span>
</div></div><div data-line="29" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c">% prints &quot;Purchase Printed&quot;</span>
</div></div><div data-line="30" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">PurchasePrinter</span> <span class="o">!</span> <span class="n">finished</span><span class="p">.</span>
</div></div><div data-line="31" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c">% prints &quot;purchases finished&quot;</span></div></div></pre></div></figure>

<h2 id="linking-processes-for-reliability">Linking Processes for Reliability</h2>

<p>Below we have a simple function which represents russian roulette. It accepts a number between 1 and 6 and if that number is three the process kills iteself. Any other number prints “click” and waits for the next message.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">roulette.erl</span><a class="code-highlight-caption-link" href="https://gist.github.com/5554054">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">-</span><span class="ni">module</span><span class="p">(</span><span class="n">roulette</span><span class="p">).</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">-</span><span class="ni">export</span><span class="p">([</span><span class="n">loop</span><span class="o">/</span><span class="mi">0</span><span class="p">]).</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c">% send a number, 1-6</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nf">loop</span><span class="p">()</span> <span class="o">-&gt;</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">receive</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="mi">3</span> <span class="o">-&gt;</span> <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;bang.</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">),</span> <span class="nb">exit</span><span class="p">(&#x7b;</span><span class="n">roulette</span><span class="p">,</span><span class="n">die</span><span class="p">,</span><span class="n">at</span><span class="p">,</span><span class="nn">erlang</span><span class="p">:</span><span class="nf">time</span><span class="p">()&#x7d;);</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="p">_</span> <span class="o">-&gt;</span> <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;click</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">),</span> <span class="n">loop</span><span class="p">()</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">end</span><span class="p">.</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nf">c</span><span class="p">(</span><span class="n">roulette</span><span class="p">).</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">Gun</span> <span class="o">=</span> <span class="nb">spawn</span><span class="p">(</span><span class="k">fun</span> <span class="nn">roulette</span><span class="p">:</span><span class="n">loop</span><span class="o">/</span><span class="mi">0</span><span class="p">).</span>
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">Gun</span> <span class="o">!</span> <span class="mi">1</span><span class="p">.</span>
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c">% prints &quot;click&quot;</span>
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">Gun</span> <span class="o">!</span> <span class="mi">3</span><span class="p">.</span>
</div></div><div data-line="15" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c">% prints &quot;bang&quot; and kills roulette process</span>
</div></div><div data-line="16" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">Gun</span> <span class="o">!</span> <span class="mi">4</span><span class="p">.</span>
</div></div><div data-line="17" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c">% does nothing as process is dead</span>
</div></div><div data-line="18" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">Gun</span> <span class="o">!</span> <span class="mi">1</span><span class="p">.</span>
</div></div><div data-line="19" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c">% does nothing as process is dead</span></div></div></pre></div></figure>

<p>In the calling code above you can see that once the value 3 has been sent further calls to the roulette process do nothing as it is dead.</p>

<p>We can verify this using the following code.</p>

<pre><code>erlang:is_process_alive(Gun).
% returns false
</code></pre>

<p>We can create our own function to monitor a process and declare when it is dead. process_flag sets a flag on the process which calls the function to convert exit signals to {‘EXIT’, From, Reason} messages, which can be received as ordinary messages. We then define how to handle the messages we receive. For a normal message we link the coroner process to any process with a PID of Process and print out that we are monitoring the process. For exit messages we print out that the process has died and why.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">coroner.erl</span><a class="code-highlight-caption-link" href="https://gist.github.com/5554054">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">-</span><span class="ni">module</span><span class="p">(</span><span class="n">coroner</span><span class="p">).</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">-</span><span class="ni">export</span><span class="p">([</span><span class="n">loop</span><span class="o">/</span><span class="mi">0</span><span class="p">]).</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nf">loop</span><span class="p">()</span> <span class="o">-&gt;</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="nb">process_flag</span><span class="p">(</span><span class="n">trap_exit</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="k">receive</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="p">&#x7b;</span><span class="nb">monitor</span><span class="p">,</span> <span class="nv">Process</span><span class="p">&#x7d;</span> <span class="o">-&gt;</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="nb">link</span><span class="p">(</span><span class="nv">Process</span><span class="p">),</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;Monitoring process.</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">),</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="n">loop</span><span class="p">();</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="p">&#x7b;</span><span class="n">&#39;EXIT&#39;</span><span class="p">,</span> <span class="nv">From</span><span class="p">,</span> <span class="nv">Reason</span><span class="p">&#x7d;</span> <span class="o">-&gt;</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;The shooter died </span>
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="s">          with reason </span><span class="si">~p</span><span class="s">.&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nv">Reason</span><span class="p">]),</span>
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;Start another one.</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">),</span>
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="n">loop</span><span class="p">()</span>
</div></div><div data-line="15" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">end</span><span class="p">.</span>
</div></div><div data-line="16" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="17" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="18" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nf">c</span><span class="p">(</span><span class="n">roulette</span><span class="p">).</span>
</div></div><div data-line="19" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nf">c</span><span class="p">(</span><span class="n">coroner</span><span class="p">).</span>
</div></div><div data-line="20" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">Revolver</span><span class="o">=</span><span class="nb">spawn</span><span class="p">(</span><span class="k">fun</span> <span class="nn">roulette</span><span class="p">:</span><span class="n">loop</span><span class="o">/</span><span class="mi">0</span><span class="p">).</span>
</div></div><div data-line="21" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">Coroner</span><span class="o">=</span><span class="nb">spawn</span><span class="p">(</span><span class="k">fun</span> <span class="nn">coroner</span><span class="p">:</span><span class="n">loop</span><span class="o">/</span><span class="mi">0</span><span class="p">).</span>
</div></div><div data-line="22" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="23" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">Coroner</span> <span class="o">!</span> <span class="p">&#x7b;</span><span class="nb">monitor</span><span class="p">,</span> <span class="nv">Revolver</span><span class="p">&#x7d;.</span>
</div></div><div data-line="24" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c">% prints Monitoring process.</span>
</div></div><div data-line="25" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="26" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">Revolver</span> <span class="o">!</span> <span class="mi">1</span><span class="p">.</span>
</div></div><div data-line="27" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c">% prints &quot;click&quot;</span>
</div></div><div data-line="28" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">Revolver</span> <span class="o">!</span> <span class="mi">3</span><span class="p">.</span>
</div></div><div data-line="29" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c">% prints &quot;bang.&quot;</span>
</div></div><div data-line="30" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c">% prints &quot;The shooter died with reason</span>
</div></div><div data-line="31" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c">%&#x7b;roulette,die,at,&#x7b;8,48,1&#x7d;&#x7d;. Start another one.%</span></div></div></pre></div></figure>

<p>We can improve on this further by creating a function that not only tells us when the process has died but then restarts it for us.When we receive a new message we spawn a roulette process and link it to our doctor process so the doctor process will get notified if it dies. We register the roulette processes id with the revolver atom. This allows us to send messages to the roulette process using revolver ! message without needing the PID. The exit handling has been enhanced to send a message to itself telling it to spawn a new game.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">doctor.erl</span><a class="code-highlight-caption-link" href="https://gist.github.com/5554054">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">-</span><span class="ni">module</span><span class="p">(</span><span class="n">doctor</span><span class="p">).</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">-</span><span class="ni">export</span><span class="p">([</span><span class="n">loop</span><span class="o">/</span><span class="mi">0</span><span class="p">]).</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nf">loop</span><span class="p">()</span> <span class="o">-&gt;</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="nb">process_flag</span><span class="p">(</span><span class="n">trap_exit</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="k">receive</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="n">new</span> <span class="o">-&gt;</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;Creating and monitoring process.</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">),</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="nb">register</span><span class="p">(</span><span class="n">revolver</span><span class="p">,</span> <span class="nb">spawn_link</span><span class="p">(</span><span class="k">fun</span> <span class="nn">roulette</span><span class="p">:</span><span class="n">loop</span><span class="o">/</span><span class="mi">0</span><span class="p">)),</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="n">loop</span><span class="p">();</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line">    <span class="p">&#x7b;</span><span class="n">&#39;EXIT&#39;</span><span class="p">,</span> <span class="nv">From</span><span class="p">,</span> <span class="nv">Reason</span><span class="p">&#x7d;</span> <span class="o">-&gt;</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot;The shooter died with reason </span><span class="si">~p</span><span class="s">.&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nv">Reason</span><span class="p">]),</span>
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="s">&quot; Restarting. </span><span class="si">~n</span><span class="s">&quot;</span><span class="p">),</span>
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="n">self</span><span class="p">()</span> <span class="o">!</span> <span class="n">new</span><span class="p">,</span>
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line">      <span class="n">loop</span><span class="p">()</span>
</div></div><div data-line="15" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="k">end</span><span class="p">.</span> 
</div></div><div data-line="16" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="17" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nf">c</span><span class="p">(</span><span class="n">doctor</span><span class="p">).</span>
</div></div><div data-line="18" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">Doc</span> <span class="o">=</span> <span class="nb">spawn</span><span class="p">(</span><span class="k">fun</span> <span class="nn">doctor</span><span class="p">:</span><span class="n">loop</span><span class="o">/</span><span class="mi">0</span><span class="p">).</span>
</div></div><div data-line="19" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">Doc</span> <span class="o">!</span> <span class="n">new</span><span class="p">.</span>
</div></div><div data-line="20" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c">% prints &quot;Creating and monitoring process.&quot;</span>
</div></div><div data-line="21" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="22" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">revolver</span> <span class="o">!</span> <span class="mi">1</span><span class="p">.</span>
</div></div><div data-line="23" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c">% prints &quot;click&quot;</span>
</div></div><div data-line="24" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="25" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="n">revolver</span> <span class="o">!</span> <span class="mi">3</span><span class="p">.</span>
</div></div><div data-line="26" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c">% prints &quot;bang.&quot;</span>
</div></div><div data-line="27" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c">% prints &quot;The shooter died with reason &#x7b;roulette,die,at,&#x7b;8,53,40&#x7d;&#x7d;.</span>
</div></div><div data-line="28" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">Restarting</span><span class="p">.</span><span class="s">&quot;</span>
</div></div><div data-line="29" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="s">% prints &quot;</span><span class="nv">Creating</span> <span class="ow">and</span> <span class="n">monitoring</span> <span class="n">process</span><span class="p">.</span><span class="s">&quot;</span>
</div></div><div data-line="30" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="31" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="s">revolver ! 4.</span>
</div></div><div data-line="32" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="s">% prints &quot;</span><span class="n">click</span><span class="s">&quot;</span></div></div></pre></div></figure>

<p>This is just a basic example to demonstrate how Erlang creates robust concurrent systems by providing libraries that make it easy to monitor processes, determine when they have crashed and restart them. As mentioned in previous blogs Erlang encourages you to ‘Let it crash’ rather than putting in lots of error handling.</p>

<h2 id="self-study">Self Study</h2>

<p>Open Telecom Platform (OTP) is a powerful package with much of what you’ll need to build a distributed, concurrent service.</p>

<h3 id="find">Find:</h3>

<p><em>An OTP service that will restart a process if it dies</em></p>

<p>http://www.erlang.org/doc/design_principles/sup_princ.html</p>

<p>http://www.hccp.org/supervisors.html</p>

<p><em>Documentation for building a simple OTP server</em></p>

<p>http://learnyousomeerlang.com/what-is-otp</p>

<p>http://20bits.com/article/erlang-a-generic-server-tutorial</p>

<h3 id="do">Do:</h3>

<ul>
  <li>Monitor the translate_service and restart it should it die.</li>
  <li>Make the Doctor process restart itself if it should die.</li>
  <li>Make a monitor for the Doctor monitor. If either monitor dies, restart it.</li>
</ul>

<p>The following bonus questions will take a little bit of research to complete:</p>

<ul>
  <li>Create a basic OTP server that logs messages to a file.</li>
  <li>Make the translate_service work across a network.</li>
</ul>

<p>Check out my code at <a href="https://github.com/heatherjc07/seven_languages_in_seven_days/tree/master/Erlang/Day2" target="_blank">github</a></p>

        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="http://heatherjcampbell.com/development/erlang-day-2/" class="btn" title="Erlang Day 2">Previous article</a>
      
      
        <a href="http://heatherjcampbell.com/development/communication/" class="btn" title="Communication">Next article</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2016 Heather Campbell. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/so-simple/">So Simple Theme</a>.</span>
<div class="social-icons">
	<a href="http://twitter.com/hcampbell07" title="Heather Campbell on Twitter" target="_blank"><i class="icon-twitter icon-2x"></i></a>
	
	
	
	
	
	
	<a href="http://github.com/heatherjc07" title="Heather Campbell on Github" target="_blank"><i class="icon-github icon-2x"></i></a>
	
</div><!-- /.social-icons -->
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://heatherjcampbell.com/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://heatherjcampbell.com/assets/js/scripts.min.js"></script>

<!-- Jekyll Simple Search option -->
<script>
  $(document).ready(function() {
      $('.search-field').simpleJekyllSearch({
          jsonFile : 'http://heatherjcampbell.com/search.json',
          searchResults : '.search-results',
          template : '<li><article><a href="{url}">{title} <span class="entry-date"><time datetime="{date}">{shortdate}</time></span></a></article></li>',
          noResults: '<p>Nothing found.</p>'
        });
  });

  (function( $, window, undefined ) {
    
     var bs = {
          close: $(".icon-remove-sign"),
          searchform: $(".search-form"),
          canvas: $("body"),
          dothis: $('.dosearch')
      };
    
    bs.dothis.on('click', function() {
      $('.search-wrapper').css({ display: "block" });
      bs.searchform.toggleClass('active');
      bs.searchform.find('input').focus();
      bs.canvas.toggleClass('search-overlay');
    });
    
      bs.close.on('click', function() {
        $('.search-wrapper').removeAttr( 'style' );
        bs.searchform.toggleClass('active');
        bs.canvas.removeClass('search-overlay');
    });
  })( jQuery, window );
</script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl = 
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-69172837-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>	        

</body>
</html>
