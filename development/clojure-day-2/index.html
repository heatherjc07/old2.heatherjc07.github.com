<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Clojure Day 2 &#8211; Technical Musing of a Mummy</title>
<meta name="description" content="Clojure Day 2: Seven Languages in Seven Weeks">
<meta name="keywords" content="seven languages in seven weeks, clojure, languages">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://heatherjcampbell.com/images/">
<meta name="twitter:title" content="Clojure Day 2">
<meta name="twitter:description" content="Clojure Day 2: Seven Languages in Seven Weeks">
<meta name="twitter:creator" content="@hcampbell07">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Clojure Day 2">
<meta property="og:description" content="Clojure Day 2: Seven Languages in Seven Weeks">
<meta property="og:url" content="http://heatherjcampbell.com/development/clojure-day-2/">
<meta property="og:site_name" content="Technical Musing of a Mummy">





<link rel="canonical" href="http://heatherjcampbell.com/development/clojure-day-2/">
<link href="http://heatherjcampbell.com/feed.xml" type="application/atom+xml" rel="alternate" title="Technical Musing of a Mummy Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://heatherjcampbell.com/assets/css/main.min.css">
<link rel="stylesheet" href="http://heatherjcampbell.com/assets/css/code.css">
<!-- Webfonts -->
<script src="//use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://heatherjcampbell.com/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://heatherjcampbell.com/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://heatherjcampbell.com/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://heatherjcampbell.com/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://heatherjcampbell.com/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://heatherjcampbell.com/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://heatherjcampbell.com/images/apple-touch-icon-144x144-precomposed.png">
</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav">
	    <ul>
	        
			<li>
				
					<a href="http://heatherjcampbell.com/about/">About</a>
				 
			</li>
	        
			<li>
				
					<a href="http://heatherjcampbell.com/articles/">Posts</a>
				 
			</li>
	        
			<li>
				
					<a href="http://heatherjcampbell.com/tags/">Tags</a>
				 
			</li>
	        
			<li>
				
					<a href="https://twitter.com/HCampbell07/">Tweets</a>
				 
			</li>
	        
			<li>
				
					<a href="http://heatherjcampbell.com/presentations/">Presentations</a>
				 
			</li>
	        
			<li>
				
					<a href="http://heatherjcampbell.com/reading/">Reading List</a>
				 
			</li>
	        
	        <li><a href="http://heatherjcampbell.com/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
	        <li class="dosearch"><i class="icon-search"></i> Search</li>
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<div class="search-wrapper">
	<div class="search-form">
		<input type="text" class="search-field" placeholder="Search...">
		<i class="icon-remove-sign icon-2x"></i>
		<ul class="search-results post-list"></ul><!-- /.search-results -->
	</div><!-- /.search-form -->
</div><!-- ./search-wrapper -->

<header class="masthead">
	<div class="wrap">
        <h1 class="site-title"><a href="http://heatherjcampbell.com">Technical Musing of a Mummy</a></h1>
		<h2 class="site-description" itemprop="description">A Blog About All Things IT Related</h2>
	</div>
</header><!-- /.masthead -->

<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <span class="entry-tags"><a href="http://heatherjcampbell.com/tags/#seven languages in seven weeks" title="Pages tagged seven languages in seven weeks">seven languages in seven weeks</a>&nbsp;&bull;&nbsp;<a href="http://heatherjcampbell.com/tags/#clojure" title="Pages tagged clojure">clojure</a>&nbsp;&bull;&nbsp;<a href="http://heatherjcampbell.com/tags/#languages" title="Pages tagged languages">languages</a></span>
        
          <h1 class="entry-title">Clojure Day 2</h1>
        
      </header>
      <footer class="entry-meta">
        <img src="http://heatherjcampbell.com/images/bio-photo.JPG" alt="Heather Campbell photo" class="author-photo">
        <span class="author vcard">By <span class="fn"><a href="http://heatherjcampbell.com/about/" title="About Heather Campbell">Heather Campbell</a></span></span>
        <span class="entry-date date published"><time datetime="2013-12-29T00:00:00+00:00"><i class="icon-calendar-empty"></i> December 29, 2013</time></span>
        
        
        <span><a href="http://heatherjcampbell.com/development/clojure-day-2/" rel="bookmark" title="Clojure Day 2"><i class="icon-link"></i> Permalink</a></span>
        
        <span class="social-share-facebook">
            <a href="https://www.facebook.com/sharer/sharer.php?u=http://heatherjcampbell.com/development/clojure-day-2/" title="Share on Facebook" itemprop="Facebook"><i class="icon-facebook-sign"></i> Like</a></span>
        <span class="social-share-twitter">
            <a href="https://twitter.com/intent/tweet?hashtags=development&text=Clojure Day 2&url=http://heatherjcampbell.com/development/clojure-day-2/&via=hcampbell07" title="Share on Twitter" itemprop="Twitter"><i class="icon-twitter-sign"></i> Tweet</a></span>
        <span class="social-share-googleplus">
            <a href="https://plus.google.com/share?url=http://heatherjcampbell.com/development/clojure-day-2/" title="Share on Google Plus" itemprop="GooglePlus"><i class="icon-google-plus-sign"></i> +1</a></span>
            <!-- /.social-share -->
      </footer>
      <div class="entry-content">
        <p><em>My experience with day two of exploring Clojure through <a href="http://pragprog.com/book/btlang/seven-languages-in-seven-weeks" target="_blank">Seven Languages in Seven Weeks</a>.</em></p>

<p>Todays chapter covers some of key concepts in Clojure such as sequences and the abstractionlayer that unifies all Clojure collections and ties them to Java collections. It also covers lazy evaluation and macros.</p>

<h2 id="recursion-with-loop-and-recur">Recursion with loop and recur</h2>

<p>In Scala, Prolog and Erlang I’ve seen how powerful recursion can be. Being another functional language Clojure also relies on recursion rather than iteration.The example below calculates the total of a vector. The total of an empty vector is zero; the total of a populated vector is the head plus the total of the rest of the vector.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">total.clj</span><a class="code-highlight-caption-link" href="https://gist.github.com/8174263">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="kd">defn </span><span class="nv">total</span> <span class="p">[</span><span class="nv">v</span><span class="p">]</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">empty?</span> <span class="nv">v</span><span class="p">)</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="mi">0</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nb">first </span><span class="nv">v</span><span class="p">)</span> <span class="p">(</span><span class="nf">total</span> <span class="p">(</span><span class="nb">rest </span><span class="nv">v</span><span class="p">)))))</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nf">total</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">])</span></div></div></pre></div></figure>

<p>Unlike the other functional languages we’ve look at Clojure does not support implicit tail recursion optimization because of limitations of the JVM. As discussed in previous blogs this is a strategy to counteract memory consumption in recursive functions. Instead you need to explicitly recur through the use of loop and recur. Loop binds the variable on the left to the value on the right, the body of the function is called and then the function recur invokes the loop again passing in the new values.</p>

<p>I’ll now modify the total function to use recur and loop. I bind the l variable to the vector and a c variable to 0. c will act as my accumulator holding the running total.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">total2.clj</span><a class="code-highlight-caption-link" href="https://gist.github.com/8174263">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="kd">defn </span><span class="nv">total</span> <span class="p">[</span><span class="nv">v</span><span class="p">]</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"> <span class="p">(</span><span class="k">loop </span><span class="p">[</span><span class="nv">l</span> <span class="nv">v</span>, <span class="nv">c</span> <span class="mi">0</span><span class="p">]</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">empty?</span> <span class="nv">l</span><span class="p">)</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line">   <span class="nv">c</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="p">(</span><span class="nf">recur</span> <span class="p">(</span><span class="nf">tail</span> <span class="nv">l</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">head</span> <span class="nv">l</span><span class="p">)</span> <span class="nv">c</span><span class="p">)))))</span></div></div></pre></div></figure>

<h2 id="sequences">Sequences</h2>

<p>A sequence in Clojure provides a generic way to treat all collections (both Clojure and Java) by providing a layer of abstraction round them.</p>

<p>There will be times you will want to test if you sequence meets a certain condition. In this case you use a function called a predicate. A predicate takes a test function, the sequence and returns a boolean.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">seq1.clj</span><a class="code-highlight-caption-link" href="https://gist.github.com/8174263">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">every? </span><span class="nv">number?</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="ss">:four</span><span class="p">])</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">; false as :four is not a number</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">some nil? </span><span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="nv">nil</span><span class="p">])</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">; true as at least one value is nil</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">not-every? </span><span class="nv">odd?</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">])</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">; false as all are odd</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">not-any? </span><span class="nv">number?</span> <span class="p">[</span><span class="ss">:one</span> <span class="ss">:two</span> <span class="ss">:three</span><span class="p">])</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">; true as none are numbers</span></div></div></pre></div></figure>

<h3 id="changing-a-sequence">Changing a Sequence</h3>

<p>Lets take a look at the functions provided to transform sequences.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">seq2.clj</span><a class="code-highlight-caption-link" href="https://gist.github.com/8174263">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="k">def </span><span class="nv">words</span> <span class="p">[</span><span class="s">&quot;luke&quot;</span> <span class="s">&quot;stephen&quot;</span> <span class="s">&quot;heather&quot;</span><span class="p">])</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;create a sequence of values in collection which meet criteria</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">filter </span><span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">word</span><span class="p">]</span> <span class="p">(</span><span class="nb">&gt; </span><span class="p">(</span><span class="nb">count </span><span class="nv">word</span><span class="p">)</span> <span class="mi">4</span><span class="p">))</span> <span class="nv">words</span><span class="p">)</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;(&quot;stephen&quot; &quot;heather&quot;)</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;call a function on items in a collection and returns the results. </span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">x</span><span class="p">]</span> <span class="p">(</span><span class="nb">* </span><span class="nv">x</span> <span class="nv">x</span><span class="p">))</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">])</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">; (1 1 4 9 25)</span></div></div></pre></div></figure>

<p>Like Scala and Erlang, Clojure supports list comprehensions which combine multiple lists and filters, taking the possible combinations of the lists and applying the filters.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">seq3.clj</span><a class="code-highlight-caption-link" href="https://gist.github.com/8174263">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="k">def </span><span class="nv">colors</span> <span class="p">[</span><span class="s">&quot;red&quot;</span> <span class="s">&quot;blue&quot;</span><span class="p">])</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="k">def </span><span class="nv">toys</span> <span class="p">[</span><span class="s">&quot;block&quot;</span> <span class="s">&quot;car&quot;</span><span class="p">])</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">; we&#39;re binding x to each string in list</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">for </span><span class="p">[</span><span class="nv">x</span> <span class="nv">colors</span><span class="p">]</span> <span class="p">(</span><span class="nb">str </span><span class="s">&quot;I like &quot;</span> <span class="nv">x</span><span class="p">))</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">; returns (&quot;I like red&quot; &quot;I like blue&quot;)</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;binding multiple lists</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;all possible combinations</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">for </span><span class="p">[</span><span class="nv">x</span> <span class="nv">colors</span>, <span class="nv">y</span> <span class="nv">toys</span><span class="p">]</span> <span class="p">(</span><span class="nb">str </span><span class="s">&quot;I like &quot;</span> <span class="nv">x</span> <span class="s">&quot; &quot;</span> <span class="nv">y</span> <span class="s">&quot;s&quot;</span><span class="p">))</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;(&quot;I like red blocks&quot; &quot;I like red cars&quot;</span>
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;&quot;I like blue blocks&quot; &quot;I like blue cars&quot;)</span>
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;function to determine of a word is less than 4 chars</span>
</div></div><div data-line="15" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="kd">defn </span><span class="nv">small-word?</span> <span class="p">[</span><span class="nv">w</span><span class="p">]</span> <span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nb">count </span><span class="nv">w</span><span class="p">)</span> <span class="mi">4</span><span class="p">))</span>
</div></div><div data-line="16" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="17" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;only use toys values that are less than 4 chars </span>
</div></div><div data-line="18" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">for </span><span class="p">[</span><span class="nv">x</span> <span class="nv">colors</span>, <span class="nv">y</span> <span class="nv">toys</span>, <span class="ss">:when</span> <span class="p">(</span><span class="nf">small-word?</span> <span class="nv">y</span><span class="p">)]</span>
</div></div><div data-line="19" class="code-highlight-row numbered"><div class="code-highlight-line"> <span class="p">(</span><span class="nb">str </span><span class="s">&quot;I like &quot;</span> <span class="nv">x</span> <span class="s">&quot; &quot;</span> <span class="nv">y</span> <span class="s">&quot;s&quot;</span><span class="p">))</span>
</div></div><div data-line="20" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;(&quot;I like red cars&quot; &quot;I like blue cars&quot;)</span></div></div></pre></div></figure>

<p>The reduce function is Clojure’s way of accumulating the result of a function on a list.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">reduce.clj</span><a class="code-highlight-caption-link" href="https://gist.github.com/8174263">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;summing values in a list</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">reduce + </span><span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">])</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;10</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;muliplying values in a list</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">reduce * </span><span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">])</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;120</span></div></div></pre></div></figure>

<p>Here are some examples of sorting</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">sort.clj</span><a class="code-highlight-caption-link" href="https://gist.github.com/8174263">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;basic sort</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">sort </span><span class="p">[</span><span class="mi">3</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">4</span><span class="p">])</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">; returns (1 2 3 4)</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;sort on the result of a function:</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="kd">defn </span><span class="nv">abs</span> <span class="p">[</span><span class="nv">x</span><span class="p">]</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">x</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">- </span><span class="nv">x</span><span class="p">)</span> <span class="nv">x</span><span class="p">))</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;sorting on absolute value</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">sort-by </span><span class="nv">abs</span> <span class="p">[</span><span class="mi">-1</span> <span class="mi">-4</span> <span class="mi">3</span> <span class="mi">2</span><span class="p">])</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;(-1 2 3 -4)</span></div></div></pre></div></figure>

<h3 id="lazy-evaluation">Lazy Evaluation</h3>

<p>Clojure calculates sequence values as they are needed. Lets look at some of the different ways we can create sequences.</p>

<p>The range function allows you to generate sequences which have an upper and lower bound (or the default lower bound of zero).</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">range.clj</span><a class="code-highlight-caption-link" href="https://gist.github.com/8174263">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">range </span><span class="mi">1</span> <span class="mi">10</span><span class="p">)</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;returns (1 2 3 4 5 6 7 8 9)</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;increment of 3</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">range </span><span class="mi">1</span> <span class="mi">10</span> <span class="mi">3</span><span class="p">)</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;returns (1 4 7)</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;default lower bound of 0</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">range </span><span class="mi">10</span><span class="p">)</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;returns (0 1 2 3 4 5 6 7 8 9)</span></div></div></pre></div></figure>

<p>The repeat function generates an infinite sequence of one repeated element. The take function allows us to grab a number of these values.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">take.clj</span><a class="code-highlight-caption-link" href="https://gist.github.com/8174263">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">take </span><span class="mi">3</span> <span class="p">(</span><span class="nb">repeat </span><span class="s">&quot;Hello&quot;</span><span class="p">))</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">; (&quot;Hello&quot; &quot;Hello&quot; &quot;Hello&quot;)</span></div></div></pre></div></figure>

<p>You can repeat elements in a list with cycle.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">cycle.clj</span><a class="code-highlight-caption-link" href="https://gist.github.com/8174263">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">take </span><span class="mi">5</span> <span class="p">(</span><span class="nb">cycle </span><span class="p">[</span><span class="ss">:cat</span> <span class="ss">:lion</span> <span class="ss">:tiger</span><span class="p">]))</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">; returns (:cat :lion :tiger :cat :lion)</span></div></div></pre></div></figure>

<p>In the example below we build the infinite sequence. Drop the first two values in it and take the next 5. In order to make it easier to read instead of working inside out we can use left-to-right operator (-») to apply each function to a result.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">leftright.clj</span><a class="code-highlight-caption-link" href="https://gist.github.com/8174263">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;inside out</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">take </span><span class="mi">5</span> <span class="p">(</span><span class="nb">drop </span><span class="mi">2</span> <span class="p">(</span><span class="nb">cycle </span><span class="p">[</span><span class="ss">:cat</span> <span class="ss">:lion</span> <span class="ss">:tiger</span><span class="p">])))</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;(:tiger :cat :lion :tiger :cat)</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;left to right</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nf">-&gt;&gt;</span> <span class="p">[</span><span class="ss">:cat</span> <span class="ss">:lion</span> <span class="ss">:tiger</span><span class="p">]</span> <span class="p">(</span><span class="nf">cycle</span><span class="p">)</span> <span class="p">(</span><span class="nb">drop </span><span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nb">take </span><span class="mi">5</span><span class="p">))</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;(:tiger :cat :lion :tiger :cat)</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">; add separator of &quot;and&quot;</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">take </span><span class="mi">5</span> <span class="p">(</span><span class="nf">interpose</span> <span class="ss">:and</span> <span class="p">(</span><span class="nb">cycle </span><span class="p">[</span><span class="ss">:cat</span> <span class="ss">:lion</span> <span class="ss">:tiger</span><span class="p">])))</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;(:cat :and :lion :and :tiger)</span>
</div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;combining values from two sequences</span>
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">take </span><span class="mi">20</span> <span class="p">(</span><span class="nb">interleave </span><span class="p">(</span><span class="nb">cycle </span><span class="p">(</span><span class="nb">range </span><span class="mi">2</span><span class="p">))</span> <span class="p">(</span><span class="nb">cycle </span><span class="p">(</span><span class="nb">range </span><span class="mi">3</span><span class="p">))))</span>
</div></div><div data-line="15" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;(0 0 1 1 0 2 1 0 0 1 1 2 0 0 1 1 0 2 1 0)</span></div></div></pre></div></figure>

<p>Another approach to create sequences is using the iterate function. This accepts a function and a start value.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">iterate.clj</span><a class="code-highlight-caption-link" href="https://gist.github.com/8174263">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">take </span><span class="mi">5</span> <span class="p">(</span><span class="nb">iterate inc </span><span class="mi">1</span><span class="p">))</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;(1 2 3 4 5)</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">take </span><span class="mi">5</span> <span class="p">(</span><span class="nb">iterate dec </span><span class="mi">0</span><span class="p">))</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;(0 -1 -2 -3 -4)</span></div></div></pre></div></figure>

<p>In the example below we use the fib-pair function to generate a sequence of consecutive pairs in the Fibonacci sequence. We then use map to select the first element from the pair. Finally we take the first 5 values.</p>

<p>In the second example we select the 500th value using the nth function.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">fibpair.clj</span><a class="code-highlight-caption-link" href="https://gist.github.com/8174263">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;calculate consecutive pairs in the Fibonacci sequence</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="kd">defn </span><span class="nv">fib-pair</span> <span class="p">[[</span><span class="nv">a</span> <span class="nv">b</span><span class="p">]]</span> <span class="p">[</span><span class="nv">b</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">a</span> <span class="nv">b</span><span class="p">)])</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">take </span><span class="mi">5</span> <span class="p">(</span><span class="nb">map first </span><span class="p">(</span><span class="nb">iterate </span><span class="nv">fib-pair</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">1</span><span class="p">])))</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">; (1 1 2 3 5)</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">nth </span><span class="p">(</span><span class="nb">map first </span><span class="p">(</span><span class="nb">iterate </span><span class="nv">fib-pair</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">1</span><span class="p">]))</span> <span class="mi">500</span><span class="p">)</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">; returns (225... more numbers ...626)</span></div></div></pre></div></figure>

<h2 id="macros">Macros</h2>

<p>Being absolutely honest I read the macro section and felt a bit lost as to what it was about. It is in fact an easy enough concept to get your head around I just feel the book doesn’t explain it in an easy to follow fashion. A macro allows the user to extend the compiler with their own code. A couple of examples of built in macros I’ve already used are a semicolon (;) which indicates a comment and a number sign (#) which indicates an anonymous function. We can use the macro defmacro to define our own macro.</p>

<p>Say we  wanted to have a way of saying unless a condition holds carry out an action. The code below shows why we can’t use a function. The print will always occur as parameters are evaluated first.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">broken.clj</span><a class="code-highlight-caption-link" href="https://gist.github.com/8174263">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="kd">defn </span><span class="nv">unless</span> <span class="p">[</span><span class="nb">test </span><span class="nv">body</span><span class="p">]</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="nv">test</span><span class="p">)</span> <span class="nv">body</span><span class="p">))</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nf">unless</span> <span class="nv">true</span> <span class="p">(</span><span class="nb">println </span><span class="s">&quot;Danger, danger Will Robinson&quot;</span><span class="p">))</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="nv">Danger</span>, <span class="nv">danger</span> <span class="nv">Will</span> <span class="nv">Robinson</span></div></div></pre></div></figure>

<p>Instead we need to use a macro. test and body are substituted without being evaluated. We don’t want if and not to execute right away so we quote them. Our not test and if are packaged as lists.</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">unless.clj</span><a class="code-highlight-caption-link" href="https://gist.github.com/8174263">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="kd">defmacro </span><span class="nv">unless</span> <span class="p">[</span><span class="nb">test </span><span class="nv">body</span><span class="p">]</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">list </span><span class="ss">&#39;if</span> <span class="p">(</span><span class="nb">list </span><span class="ss">&#39;not</span> <span class="nv">test</span><span class="p">)</span> <span class="nv">body</span><span class="p">))</span></div></div></pre></div></figure>

<p>Expanding it gives</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">unless-expand.clj</span><a class="code-highlight-caption-link" href="https://gist.github.com/8174263">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">macroexpand </span><span class="o">&#39;</span><span class="p">(</span><span class="nf">unless</span> <span class="nv">condition</span> <span class="nv">body</span><span class="p">))</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;(if (not condition) body)</span></div></div></pre></div></figure>

<p>Executing it gives the desired behaviour</p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">unless-execute.clj</span><a class="code-highlight-caption-link" href="https://gist.github.com/8174263">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nf">unless</span> <span class="nv">true</span> <span class="p">(</span><span class="nb">println </span><span class="s">&quot;No more danger, Will.&quot;</span><span class="p">))</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">; nil</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nf">unless</span> <span class="nv">false</span> <span class="p">(</span><span class="nb">println </span><span class="s">&quot;Now, THIS is The FORCE.&quot;</span><span class="p">))</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;Now, THIS is The FORCE.</span></div></div></pre></div></figure>

<h2 id="homework">Homework</h2>
<p>###Find:</p>

<p><strong>The implementation of some of the commonly used macros in the Clojure language</strong></p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">when.clj</span><a class="code-highlight-caption-link" href="https://gist.github.com/8174263">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;when is a macro which combines if and do</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">macroexpand </span><span class="o">&#39;</span><span class="p">(</span><span class="nb">when </span><span class="p">(</span><span class="nb">pos? </span><span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nb">println </span><span class="s">&quot;positive&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">b</span> <span class="nv">a</span><span class="p">)))</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">pos? </span><span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="k">do </span><span class="p">(</span><span class="nb">println </span><span class="s">&quot;positive&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">b</span> <span class="nv">a</span><span class="p">)))</span>
</div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">; -&amp;gt; macro, recursively inserts each expression as </span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">; the first arg of the next expression</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">-&gt; </span><span class="p">&#x7b;&#x7d;</span> <span class="p">(</span><span class="nb">assoc </span><span class="ss">:a</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">assoc </span><span class="ss">:b</span> <span class="mi">2</span><span class="p">))</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">&#x7b;</span><span class="ss">:b</span> <span class="mi">2</span>, <span class="ss">:a</span> <span class="mi">1</span><span class="p">&#x7d;</span>
</div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">macroexpand </span><span class="o">&#39;</span><span class="p">(</span><span class="nb">-&gt; </span><span class="p">&#x7b;&#x7d;</span> <span class="p">(</span><span class="nb">assoc </span><span class="ss">:a</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">assoc </span><span class="ss">:b</span> <span class="mi">2</span><span class="p">)))</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">assoc </span><span class="p">(</span><span class="nf">clojure.core/-&gt;</span> <span class="p">&#x7b;&#x7d;</span> <span class="p">(</span><span class="nb">assoc </span><span class="ss">:a</span> <span class="mi">1</span><span class="p">))</span> <span class="ss">:b</span> <span class="mi">2</span><span class="p">)</span></div></div></pre></div></figure>

<p><strong>An example of defining your own lazy sequence</strong></p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">lazy-seq.clj</span><a class="code-highlight-caption-link" href="https://gist.github.com/8174263">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="k">def </span><span class="nv">factorials</span> <span class="p">(</span><span class="nf">reductions</span> <span class="nb">* </span><span class="p">(</span><span class="nb">iterate inc </span><span class="mi">1</span><span class="p">)))</span> 
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">println </span><span class="p">(</span><span class="nb">take </span><span class="mi">5</span> <span class="nv">factorials</span><span class="p">))</span>   
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="k">def </span><span class="nv">sum</span> <span class="p">(</span><span class="nf">reductions</span> <span class="nb">+ </span><span class="p">(</span><span class="nb">iterate inc </span><span class="mi">1</span><span class="p">)))</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">println </span><span class="p">(</span><span class="nb">take </span><span class="mi">5</span> <span class="nv">sum</span><span class="p">))</span></div></div></pre></div></figure>

<p><strong>The current status of the defrecord and protocol features (these features were still under development as this book was being developed)</strong></p>

<p><a href="http://clojuredocs.org/clojure_core/1.3.0/clojure.core/defrecord">defrecord</a></p>

<p><a href="http://clojuredocs.org/clojure_core/1.3.0/clojure.core/defprotocol">defprotocol</a></p>

<p>This article gives a nice explanation of protocols and defrecord and their use: <a href="http://www.ibm.com/developerworks/java/library/j-clojure-protocols/index.html#datatypes">Solving the Expression Problem with Clojure 1.2</a>. Protocols allow you to add functions to existing types without modifying or recompiling your existing code. defrecord creates a container for structured data that combines the features of maps and classes.</p>

<h3 id="do">Do:</h3>

<p><strong>Implement an unless with an else condition using macros.</strong></p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">unless-else.clj</span><a class="code-highlight-caption-link" href="https://gist.github.com/8174263">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="kd">defmacro </span><span class="nv">unless-else</span> <span class="p">[</span><span class="nb">test </span><span class="nv">ifbody</span> <span class="nv">elsebody</span><span class="p">]</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">list </span><span class="ss">&#39;if</span> <span class="p">(</span><span class="nb">list </span><span class="ss">&#39;not</span> <span class="nv">test</span><span class="p">)</span> <span class="nv">ifbody</span> <span class="nv">elsebody</span><span class="p">))</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nf">unless-else</span> <span class="nv">false</span> <span class="p">(</span><span class="nb">println </span><span class="s">&quot;unless body&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nb">println </span><span class="s">&quot;else body&quot;</span><span class="p">))</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nf">unless-else</span> <span class="nv">true</span> <span class="p">(</span><span class="nb">println </span><span class="s">&quot;unless body&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nb">println </span><span class="s">&quot;else body&quot;</span><span class="p">))</span></div></div></pre></div></figure>

<p><strong>Write a type using defrecord that implements a protocol.</strong></p>

<figure class="code-highlight-figure"><figcaption class="code-highlight-caption"><span class="code-highlight-caption-title">protocol.clj</span><a class="code-highlight-caption-link" href="https://gist.github.com/8174263">link</a></figcaption><div class="code-highlight"><pre class="code-highlight-pre"><div data-line="1" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;define namespace</span>
</div></div><div data-line="2" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="kd">ns </span><span class="nv">com.campbell</span><span class="p">)</span>
</div></div><div data-line="3" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="4" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;define a protocol</span>
</div></div><div data-line="5" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="kd">defprotocol </span><span class="nv">Fulfillment</span>
</div></div><div data-line="6" class="code-highlight-row numbered"><div class="code-highlight-line"> <span class="p">(</span><span class="nf">invoice</span> <span class="p">[</span><span class="nv">this</span><span class="p">]</span> <span class="s">&quot;Returns an invoice&quot;</span><span class="p">)</span>
</div></div><div data-line="7" class="code-highlight-row numbered"><div class="code-highlight-line"> <span class="p">(</span><span class="nf">manifest</span> <span class="p">[</span><span class="nv">this</span><span class="p">]</span> <span class="s">&quot;Returns a shipping manifest&quot;</span><span class="p">))</span>
</div></div><div data-line="8" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="9" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;define a product record</span>
</div></div><div data-line="10" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="kd">defrecord </span><span class="nv">Product</span> <span class="p">[</span><span class="nb">name </span><span class="nv">price</span><span class="p">])</span>
</div></div><div data-line="11" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="12" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;create pencil product record and check fields</span>
</div></div><div data-line="13" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="k">def </span><span class="nv">pencil</span> <span class="p">(</span><span class="nf">Product.</span> <span class="s">&quot;Pencil&quot;</span> <span class="mi">30</span><span class="p">))</span>
</div></div><div data-line="14" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">println </span><span class="p">(</span><span class="ss">:name</span> <span class="nv">pencil</span><span class="p">))</span>
</div></div><div data-line="15" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">println </span><span class="p">(</span><span class="ss">:price</span> <span class="nv">pencil</span><span class="p">))</span>
</div></div><div data-line="16" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="17" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;create pen product record and check fields</span>
</div></div><div data-line="18" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="k">def </span><span class="nv">pen</span> <span class="p">(</span><span class="nf">Product.</span> <span class="s">&quot;Pen&quot;</span> <span class="mi">150</span><span class="p">))</span>
</div></div><div data-line="19" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">println </span><span class="p">(</span><span class="ss">:name</span> <span class="nv">pen</span><span class="p">))</span>
</div></div><div data-line="20" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">println </span><span class="p">(</span><span class="ss">:price</span> <span class="nv">pen</span><span class="p">))</span>
</div></div><div data-line="21" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="22" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;function for current time, not nicely formatted</span>
</div></div><div data-line="23" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="kd">defn </span><span class="nv">current-time</span> <span class="p">[]</span> 
</div></div><div data-line="24" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="p">(</span><span class="k">. </span><span class="p">(</span><span class="k">new </span><span class="nv">java.util.Date</span><span class="p">)</span> <span class="p">(</span><span class="nf">toString</span><span class="p">)))</span> 
</div></div><div data-line="25" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="26" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;list of products purchased</span>
</div></div><div data-line="27" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="k">def </span><span class="nv">products</span> <span class="p">&#x7b;</span><span class="nv">pen</span> <span class="mi">1</span>, <span class="nv">pencil</span> <span class="mi">5</span><span class="p">&#x7d;)</span>
</div></div><div data-line="28" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="29" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;function to build pretty product list string</span>
</div></div><div data-line="30" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="kd">defn </span><span class="nv">product-string</span> <span class="p">[</span><span class="nv">products</span><span class="p">]</span> 
</div></div><div data-line="31" class="code-highlight-row numbered"><div class="code-highlight-line"> <span class="p">(</span><span class="nb">apply </span><span class="nv">str</span><span class="p">(</span><span class="nb">doall </span><span class="p">(</span><span class="nb">for </span><span class="p">[[</span><span class="nv">k</span> <span class="nv">v</span><span class="p">]</span> <span class="nv">products</span><span class="p">]</span> 
</div></div><div data-line="32" class="code-highlight-row numbered"><div class="code-highlight-line">  <span class="p">(</span><span class="nb">str </span><span class="nv">v</span> <span class="s">&quot; &quot;</span><span class="p">(</span><span class="ss">:name</span> <span class="nv">k</span><span class="p">)</span> <span class="s">&quot; @ &quot;</span> <span class="p">(</span><span class="ss">:price</span> <span class="nv">k</span><span class="p">)</span> <span class="s">&quot; pence\n&quot;</span><span class="p">)))</span>
</div></div><div data-line="33" class="code-highlight-row numbered"><div class="code-highlight-line"> <span class="p">)</span>
</div></div><div data-line="34" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">)</span>
</div></div><div data-line="35" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="36" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">; define a purchase order record which implements </span>
</div></div><div data-line="37" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">; Fulfillment protocol</span>
</div></div><div data-line="38" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="kd">defrecord </span><span class="nv">PurchaseOrder</span> <span class="p">[</span><span class="nv">date</span> <span class="nv">customer</span> <span class="nv">products</span><span class="p">]</span>
</div></div><div data-line="39" class="code-highlight-row numbered"><div class="code-highlight-line"> <span class="nv">Fulfillment</span>
</div></div><div data-line="40" class="code-highlight-row numbered"><div class="code-highlight-line"> <span class="p">(</span><span class="nf">invoice</span> <span class="p">[</span><span class="nv">this</span><span class="p">]</span>
</div></div><div data-line="41" class="code-highlight-row numbered"><div class="code-highlight-line"> <span class="p">(</span><span class="nb">str </span><span class="p">(</span><span class="nf">format</span> <span class="s">&quot;Invoice for %s \nDate %s&quot;</span> <span class="nv">customer</span> <span class="nv">date</span><span class="p">)</span> <span class="s">&quot;\n&quot;</span> 
</div></div><div data-line="42" class="code-highlight-row numbered"><div class="code-highlight-line">        <span class="p">(</span><span class="nf">product-string</span> <span class="nv">products</span><span class="p">)))</span>
</div></div><div data-line="43" class="code-highlight-row numbered"><div class="code-highlight-line"> <span class="p">(</span><span class="nf">manifest</span> <span class="p">[</span><span class="nv">this</span><span class="p">]</span>
</div></div><div data-line="44" class="code-highlight-row numbered"><div class="code-highlight-line"> <span class="p">(</span><span class="nb">str </span><span class="s">&quot;Shipping to &quot;</span> <span class="nv">customer</span> <span class="s">&quot;\n&quot;</span> <span class="p">(</span><span class="nf">product-string</span> <span class="nv">products</span><span class="p">))))</span>
</div></div><div data-line="45" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="46" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">; create puchase order object</span>
</div></div><div data-line="47" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="k">def </span><span class="nv">po</span> <span class="p">(</span><span class="nf">PurchaseOrder.</span> <span class="p">(</span><span class="nf">current-time</span><span class="p">)</span>
</div></div><div data-line="48" class="code-highlight-row numbered"><div class="code-highlight-line"> <span class="s">&quot;Heather Campbell&quot;</span>
</div></div><div data-line="49" class="code-highlight-row numbered"><div class="code-highlight-line"> <span class="nv">products</span><span class="p">))</span>
</div></div><div data-line="50" class="code-highlight-row numbered"><div class="code-highlight-line"> </div></div><div data-line="51" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="c1">;print out various fields belonging to obj</span>
</div></div><div data-line="52" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nf">println</span><span class="p">(</span><span class="ss">:date</span> <span class="nv">po</span><span class="p">))</span>
</div></div><div data-line="53" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nf">println</span><span class="p">(</span><span class="ss">:customer</span> <span class="nv">po</span><span class="p">))</span>
</div></div><div data-line="54" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nf">println</span><span class="p">(</span><span class="ss">:products</span> <span class="nv">po</span><span class="p">))</span>
</div></div><div data-line="55" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">println </span><span class="p">(</span><span class="nf">invoice</span> <span class="nv">po</span><span class="p">))</span>
</div></div><div data-line="56" class="code-highlight-row numbered"><div class="code-highlight-line"><span class="p">(</span><span class="nb">println </span><span class="p">(</span><span class="nf">manifest</span> <span class="nv">po</span><span class="p">))</span></div></div></pre></div></figure>

<p>Check out my code at <a href="https://github.com/heatherjc07/seven_languages_in_seven_days/tree/master/Clojure/Day2">github</a>.</p>

        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="http://heatherjcampbell.com/development/clojure-day-1/" class="btn" title="Clojure Day 1">Previous article</a>
      
      
        <a href="http://heatherjcampbell.com/culture/dont-give-up-on-the-late-bloomer/" class="btn" title="Don't Give Up on The Late Bloomer">Next article</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2016 Heather Campbell. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/so-simple/">So Simple Theme</a>.</span>
<div class="social-icons">
	<a href="http://twitter.com/hcampbell07" title="Heather Campbell on Twitter" target="_blank"><i class="icon-twitter icon-2x"></i></a>
	
	
	
	
	
	
	<a href="http://github.com/heatherjc07" title="Heather Campbell on Github" target="_blank"><i class="icon-github icon-2x"></i></a>
	
</div><!-- /.social-icons -->
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://heatherjcampbell.com/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://heatherjcampbell.com/assets/js/scripts.min.js"></script>

<!-- Jekyll Simple Search option -->
<script>
  $(document).ready(function() {
      $('.search-field').simpleJekyllSearch({
          jsonFile : 'http://heatherjcampbell.com/search.json',
          searchResults : '.search-results',
          template : '<li><article><a href="{url}">{title} <span class="entry-date"><time datetime="{date}">{shortdate}</time></span></a></article></li>',
          noResults: '<p>Nothing found.</p>'
        });
  });

  (function( $, window, undefined ) {
    
     var bs = {
          close: $(".icon-remove-sign"),
          searchform: $(".search-form"),
          canvas: $("body"),
          dothis: $('.dosearch')
      };
    
    bs.dothis.on('click', function() {
      $('.search-wrapper').css({ display: "block" });
      bs.searchform.toggleClass('active');
      bs.searchform.find('input').focus();
      bs.canvas.toggleClass('search-overlay');
    });
    
      bs.close.on('click', function() {
        $('.search-wrapper').removeAttr( 'style' );
        bs.searchform.toggleClass('active');
        bs.canvas.removeClass('search-overlay');
    });
  })( jQuery, window );
</script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl = 
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-69172837-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>	        

</body>
</html>
